{"version":3,"sources":["../../../src/schema/types/pagination.ts"],"names":["getPageInfo","schemaComposer","getOrCreateOTC","tc","addFields","currentPage","hasPreviousPage","hasNextPage","itemCount","pageCount","perPage","totalCount","getEdge","typeComposer","typeName","getTypeName","derivedTypeName","next","node","getTypeNonNull","previous","createPagination","fields","paginationTypeComposer","edges","nodes","pageInfo","makeFieldNonNull","getGroup","field","fieldValue","getPagination","inputTypeComposer","getInputTypeComposer","fieldsEnumTC","distinct","type","args","resolve","max","min","sum","group","skip","limit"],"mappings":";;;;;AAOA;;AACA;;AACA;;AAEO,MAAMA,WAAW,GAAG,CAAiB;AAC1CC,EAAAA;AAD0C,CAAjB,KAKzBA,cAAc,CAACC,cAAf,CAA+B,UAA/B,EAA0CC,EAAE,IAAI;AAC9CA,EAAAA,EAAE,CAACC,SAAH,CAAa;AACXC,IAAAA,WAAW,EAAG,MADH;AAEXC,IAAAA,eAAe,EAAG,UAFP;AAGXC,IAAAA,WAAW,EAAG,UAHH;AAIXC,IAAAA,SAAS,EAAG,MAJD;AAKXC,IAAAA,SAAS,EAAG,MALD;AAMXC,IAAAA,OAAO,EAAG,KANC;AAOXC,IAAAA,UAAU,EAAG;AAPF,GAAb;AASD,CAVD,CALK;;;;AAiBA,MAAMC,OAAO,GAAG,CAAiB;AACtCX,EAAAA,cADsC;AAEtCY,EAAAA;AAFsC,CAAjB,KAMG;AACxB,QAAMC,QAAQ,GAAI,GAAED,YAAY,CAACE,WAAb,EAA2B,MAA/C;AACA,oCAAe;AAAEF,IAAAA,YAAF;AAAgBG,IAAAA,eAAe,EAAEF;AAAjC,GAAf;AACA,SAAOb,cAAc,CAACC,cAAf,CAA8BY,QAA9B,EAAwCX,EAAE,IAAI;AACnDA,IAAAA,EAAE,CAACC,SAAH,CAAa;AACXa,MAAAA,IAAI,EAAEJ,YADK;AAEXK,MAAAA,IAAI,EAAEL,YAAY,CAACM,cAAb,EAFK;AAGXC,MAAAA,QAAQ,EAAEP;AAHC,KAAb;AAKD,GANM,CAAP;AAOD,CAhBM;;;;AAkBP,MAAMQ,gBAAgB,GAAG,CAAgC;AACvDpB,EAAAA,cADuD;AAEvDY,EAAAA,YAFuD;AAGvDS,EAAAA,MAHuD;AAIvDR,EAAAA;AAJuD,CAAhC,KAUC;AACxB,QAAMS,sBAA0C,GAC9CtB,cAAc,CAACC,cAAf,CAA8BY,QAA9B,EAAwCX,EAAE,IAAI;AAC5CA,IAAAA,EAAE,CAACC,SAAH,CAAa;AACXO,MAAAA,UAAU,EAAG,MADF;AAEXa,MAAAA,KAAK,EAAE,CAACZ,OAAO,CAAC;AAAEX,QAAAA,cAAF;AAAkBY,QAAAA;AAAlB,OAAD,CAAP,CAA0CM,cAA1C,EAAD,CAFI;AAGXM,MAAAA,KAAK,EAAE,CAACZ,YAAY,CAACM,cAAb,EAAD,CAHI;AAIXO,MAAAA,QAAQ,EAAE1B,WAAW,CAAC;AAAEC,QAAAA;AAAF,OAAD,CAAX,CAAgCkB,cAAhC,EAJC;AAKX,SAAGG;AALQ,KAAb;AAOD,GARD,CADF;AAUAC,EAAAA,sBAAsB,CAACI,gBAAvB,CAAyC,OAAzC;AACAJ,EAAAA,sBAAsB,CAACI,gBAAvB,CAAyC,OAAzC;AACA,oCAAe;AAAEd,IAAAA,YAAF;AAAgBG,IAAAA,eAAe,EAAEF;AAAjC,GAAf;AACA,SAAOS,sBAAP;AACD,CAzBD;;AA2BO,MAAMK,QAAQ,GAAG,CAAiB;AACvC3B,EAAAA,cADuC;AAEvCY,EAAAA;AAFuC,CAAjB,KAME;AACxB,QAAMC,QAAQ,GAAI,GAAED,YAAY,CAACE,WAAb,EAA2B,iBAA/C;AACA,QAAMO,MAAM,GAAG;AACbO,IAAAA,KAAK,EAAG,SADK;AAEbC,IAAAA,UAAU,EAAG;AAFA,GAAf;AAIA,SAAOT,gBAAgB,CAAC;AAAEpB,IAAAA,cAAF;AAAkBY,IAAAA,YAAlB;AAAgCS,IAAAA,MAAhC;AAAwCR,IAAAA;AAAxC,GAAD,CAAvB;AACD,CAbM;;;;AAeA,MAAMiB,aAAa,GAAG,CAAiB;AAC5C9B,EAAAA,cAD4C;AAE5CY,EAAAA;AAF4C,CAAjB,KAMH;AACxB,QAAMmB,iBAAoC,GACxCnB,YAAY,CAACoB,oBAAb,EADF;AAEA,QAAMnB,QAAQ,GAAI,GAAED,YAAY,CAACE,WAAb,EAA2B,YAA/C;AACA,QAAMmB,YAAY,GAAG,yBAAc;AACjCjC,IAAAA,cADiC;AAEjCY,IAAAA,YAFiC;AAGjCmB,IAAAA;AAHiC,GAAd,CAArB;AAKA,QAAMV,MAA8B,GAAG;AACrCa,IAAAA,QAAQ,EAAE;AACRC,MAAAA,IAAI,EAAE,CAAE,SAAF,CADE;AAERC,MAAAA,IAAI,EAAE;AACJR,QAAAA,KAAK,EAAEK,YAAY,CAACf,cAAb;AADH,OAFE;AAKRmB,MAAAA,OAAO,EAAEH;AALD,KAD2B;AAQrCI,IAAAA,GAAG,EAAE;AACHH,MAAAA,IAAI,EAAG,OADJ;AAEHC,MAAAA,IAAI,EAAE;AACJR,QAAAA,KAAK,EAAEK,YAAY,CAACf,cAAb;AADH,OAFH;AAKHmB,MAAAA,OAAO,EAAEC;AALN,KARgC;AAerCC,IAAAA,GAAG,EAAE;AACHJ,MAAAA,IAAI,EAAG,OADJ;AAEHC,MAAAA,IAAI,EAAE;AACJR,QAAAA,KAAK,EAAEK,YAAY,CAACf,cAAb;AADH,OAFH;AAKHmB,MAAAA,OAAO,EAAEE;AALN,KAfgC;AAsBrCC,IAAAA,GAAG,EAAE;AACHL,MAAAA,IAAI,EAAG,OADJ;AAEHC,MAAAA,IAAI,EAAE;AACJR,QAAAA,KAAK,EAAEK,YAAY,CAACf,cAAb;AADH,OAFH;AAKHmB,MAAAA,OAAO,EAAEG;AALN,KAtBgC;AA6BrCC,IAAAA,KAAK,EAAE;AACLN,MAAAA,IAAI,EAAE,CAACR,QAAQ,CAAC;AAAE3B,QAAAA,cAAF;AAAkBY,QAAAA;AAAlB,OAAD,CAAR,CAA2CM,cAA3C,EAAD,CADD;AAELkB,MAAAA,IAAI,EAAE;AACJM,QAAAA,IAAI,EAAG,KADH;AAEJC,QAAAA,KAAK,EAAG,KAFJ;AAGJf,QAAAA,KAAK,EAAEK,YAAY,CAACf,cAAb;AAHH,OAFD;AAOLmB,MAAAA,OAAO,EAAEI;AAPJ;AA7B8B,GAAvC;AAuCA,QAAMnB,sBAA0C,GAAGF,gBAAgB,CAAC;AAClEpB,IAAAA,cADkE;AAElEY,IAAAA,YAFkE;AAGlES,IAAAA,MAHkE;AAIlER,IAAAA;AAJkE,GAAD,CAAnE;AAMAS,EAAAA,sBAAsB,CAACI,gBAAvB,CAAyC,UAAzC;AACAJ,EAAAA,sBAAsB,CAACI,gBAAvB,CAAyC,OAAzC;AACA,SAAOJ,sBAAP;AACD,CA/DM","sourcesContent":["import {\n  SchemaComposer,\n  ObjectTypeComposer,\n  InputTypeComposer,\n  InterfaceTypeComposer,\n  ObjectTypeComposerFieldConfigMapDefinition,\n} from \"graphql-compose\"\nimport { getFieldsEnum } from \"./sort\"\nimport { addDerivedType } from \"./derived-types\"\nimport { distinct, group, max, min, sum } from \"../resolvers\"\n\nexport const getPageInfo = <TContext = any>({\n  schemaComposer,\n}: {\n  schemaComposer: SchemaComposer<TContext>\n}): ObjectTypeComposer =>\n  schemaComposer.getOrCreateOTC(`PageInfo`, tc => {\n    tc.addFields({\n      currentPage: `Int!`,\n      hasPreviousPage: `Boolean!`,\n      hasNextPage: `Boolean!`,\n      itemCount: `Int!`,\n      pageCount: `Int!`,\n      perPage: `Int`,\n      totalCount: `Int!`,\n    })\n  })\n\nexport const getEdge = <TContext = any>({\n  schemaComposer,\n  typeComposer,\n}: {\n  schemaComposer: SchemaComposer<TContext>\n  typeComposer: ObjectTypeComposer | InterfaceTypeComposer\n}): ObjectTypeComposer => {\n  const typeName = `${typeComposer.getTypeName()}Edge`\n  addDerivedType({ typeComposer, derivedTypeName: typeName })\n  return schemaComposer.getOrCreateOTC(typeName, tc => {\n    tc.addFields({\n      next: typeComposer,\n      node: typeComposer.getTypeNonNull(),\n      previous: typeComposer,\n    })\n  })\n}\n\nconst createPagination = <TSource = any, TContext = any>({\n  schemaComposer,\n  typeComposer,\n  fields,\n  typeName,\n}: {\n  schemaComposer: SchemaComposer<TContext>\n  typeComposer: ObjectTypeComposer | InterfaceTypeComposer\n  fields: ObjectTypeComposerFieldConfigMapDefinition<TSource, TContext>\n  typeName: string\n}): ObjectTypeComposer => {\n  const paginationTypeComposer: ObjectTypeComposer =\n    schemaComposer.getOrCreateOTC(typeName, tc => {\n      tc.addFields({\n        totalCount: `Int!`,\n        edges: [getEdge({ schemaComposer, typeComposer }).getTypeNonNull()],\n        nodes: [typeComposer.getTypeNonNull()],\n        pageInfo: getPageInfo({ schemaComposer }).getTypeNonNull(),\n        ...fields,\n      })\n    })\n  paginationTypeComposer.makeFieldNonNull(`edges`)\n  paginationTypeComposer.makeFieldNonNull(`nodes`)\n  addDerivedType({ typeComposer, derivedTypeName: typeName })\n  return paginationTypeComposer\n}\n\nexport const getGroup = <TContext = any>({\n  schemaComposer,\n  typeComposer,\n}: {\n  schemaComposer: SchemaComposer<TContext>\n  typeComposer: ObjectTypeComposer | InterfaceTypeComposer\n}): ObjectTypeComposer => {\n  const typeName = `${typeComposer.getTypeName()}GroupConnection`\n  const fields = {\n    field: `String!`,\n    fieldValue: `String`,\n  }\n  return createPagination({ schemaComposer, typeComposer, fields, typeName })\n}\n\nexport const getPagination = <TContext = any>({\n  schemaComposer,\n  typeComposer,\n}: {\n  schemaComposer: SchemaComposer<TContext>\n  typeComposer: ObjectTypeComposer | InterfaceTypeComposer\n}): ObjectTypeComposer => {\n  const inputTypeComposer: InputTypeComposer =\n    typeComposer.getInputTypeComposer()\n  const typeName = `${typeComposer.getTypeName()}Connection`\n  const fieldsEnumTC = getFieldsEnum({\n    schemaComposer,\n    typeComposer,\n    inputTypeComposer,\n  })\n  const fields: { [key: string]: any } = {\n    distinct: {\n      type: [`String!`],\n      args: {\n        field: fieldsEnumTC.getTypeNonNull(),\n      },\n      resolve: distinct,\n    },\n    max: {\n      type: `Float`,\n      args: {\n        field: fieldsEnumTC.getTypeNonNull(),\n      },\n      resolve: max,\n    },\n    min: {\n      type: `Float`,\n      args: {\n        field: fieldsEnumTC.getTypeNonNull(),\n      },\n      resolve: min,\n    },\n    sum: {\n      type: `Float`,\n      args: {\n        field: fieldsEnumTC.getTypeNonNull(),\n      },\n      resolve: sum,\n    },\n    group: {\n      type: [getGroup({ schemaComposer, typeComposer }).getTypeNonNull()],\n      args: {\n        skip: `Int`,\n        limit: `Int`,\n        field: fieldsEnumTC.getTypeNonNull(),\n      },\n      resolve: group,\n    },\n  }\n  const paginationTypeComposer: ObjectTypeComposer = createPagination({\n    schemaComposer,\n    typeComposer,\n    fields,\n    typeName,\n  })\n  paginationTypeComposer.makeFieldNonNull(`distinct`)\n  paginationTypeComposer.makeFieldNonNull(`group`)\n  return paginationTypeComposer\n}\n"],"file":"pagination.js"}