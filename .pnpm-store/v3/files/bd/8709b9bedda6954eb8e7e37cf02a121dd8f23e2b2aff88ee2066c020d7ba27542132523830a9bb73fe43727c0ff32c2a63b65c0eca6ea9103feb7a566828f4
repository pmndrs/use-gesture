var t,e,n,i,r,a,s,o,l=new Uint8Array([0]),f=[171,75,84,88,32,50,48,187,13,10,26,10];(t=exports.KTX2SupercompressionScheme||(exports.KTX2SupercompressionScheme={}))[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB",(e=exports.KTX2DescriptorType||(exports.KTX2DescriptorType={}))[e.BASICFORMAT=0]="BASICFORMAT",(n=exports.KTX2Model||(exports.KTX2Model={}))[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.ETC1S=163]="ETC1S",n[n.UASTC=166]="UASTC",(i=exports.KTX2Primaries||(exports.KTX2Primaries={}))[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.SRGB=1]="SRGB",(r=exports.KTX2Transfer||(exports.KTX2Transfer={}))[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.LINEAR=1]="LINEAR",r[r.SRGB=2]="SRGB",r[r.ITU=3]="ITU",r[r.NTSC=4]="NTSC",r[r.SLOG=5]="SLOG",r[r.SLOG2=6]="SLOG2",(a=exports.KTX2Flags||(exports.KTX2Flags={}))[a.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",a[a.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED",(s=exports.KTX2ChannelETC1S||(exports.KTX2ChannelETC1S={}))[s.RGB=0]="RGB",s[s.RRR=3]="RRR",s[s.GGG=4]="GGG",s[s.AAA=15]="AAA",(o=exports.KTX2ChannelUASTC||(exports.KTX2ChannelUASTC={}))[o.RGB=0]="RGB",o[o.RGBA=3]="RGBA",o[o.RRR=4]="RRR",o[o.RRRG=5]="RRRG";var U=function(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=exports.KTX2SupercompressionScheme.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:exports.KTX2DescriptorType.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:exports.KTX2Model.UNSPECIFIED,colorPrimaries:exports.KTX2Primaries.SRGB,transferFunction:exports.KTX2Primaries.SRGB,flags:exports.KTX2Flags.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null},p=function(){function t(t,e,n,i){this._dataView=new DataView(t.buffer,t.byteOffset+e,n),this._littleEndian=i,this._offset=0}var e=t.prototype;return e._nextUint8=function(){var t=this._dataView.getUint8(this._offset);return this._offset+=1,t},e._nextUint16=function(){var t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t},e._nextUint32=function(){var t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t},e._nextUint64=function(){var t=this._dataView.getUint32(this._offset,this._littleEndian),e=this._dataView.getUint32(this._offset+4,this._littleEndian),n=t+Math.pow(2,32)*e;return this._offset+=8,n},e._skip=function(t){return this._offset+=t,this},e._scan=function(t,e){void 0===e&&(e=0);for(var n=this._offset,i=0;this._dataView.getUint8(this._offset)!==e&&i<t;)i++,this._offset++;return i<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)},t}();function h(){return(h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function x(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return c(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,void 0):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}function u(t){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(t):Buffer.from(t)}function _(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):Buffer.from(t).toString("utf8")}function g(t){for(var e,n=0,i=x(t);!(e=i()).done;)n+=e.value.byteLength;for(var r,a=new Uint8Array(n),s=0,o=x(t);!(r=o()).done;){var l=r.value;a.set(new Uint8Array(l),s),s+=l.byteLength}return a}var y={keepWriter:!1};exports.KTX2Container=U,exports.read=function(t){var e=new Uint8Array(t.buffer,t.byteOffset,f.length);if(e[0]!==f[0]||e[1]!==f[1]||e[2]!==f[2]||e[3]!==f[3]||e[4]!==f[4]||e[5]!==f[5]||e[6]!==f[6]||e[7]!==f[7]||e[8]!==f[8]||e[9]!==f[9]||e[10]!==f[10]||e[11]!==f[11])throw new Error("Missing KTX 2.0 identifier.");var n=new U,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new p(t,f.length,i,!0);n.vkFormat=r._nextUint32(),n.typeSize=r._nextUint32(),n.pixelWidth=r._nextUint32(),n.pixelHeight=r._nextUint32(),n.pixelDepth=r._nextUint32(),n.layerCount=r._nextUint32(),n.faceCount=r._nextUint32();var a=r._nextUint32();n.supercompressionScheme=r._nextUint32();for(var s=r._nextUint32(),o=r._nextUint32(),l=r._nextUint32(),h=r._nextUint32(),c=r._nextUint64(),x=r._nextUint64(),u=new p(t,f.length+i,3*a*8,!0),g=0;g<a;g++)n.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});for(var y=new p(t,s,o,!0),d={vendorId:y._skip(4)._nextUint16(),descriptorType:y._nextUint16(),versionNumber:y._nextUint16(),descriptorBlockSize:y._nextUint16(),colorModel:y._nextUint8(),colorPrimaries:y._nextUint8(),transferFunction:y._nextUint8(),flags:y._nextUint8(),texelBlockDimension:{x:y._nextUint8()+1,y:y._nextUint8()+1,z:y._nextUint8()+1,w:y._nextUint8()+1},bytesPlane:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],samples:[]},b=(d.descriptorBlockSize/4-6)/4,D=0;D<b;D++)d.samples[D]={bitOffset:y._nextUint16(),bitLength:y._nextUint8(),channelID:y._nextUint8(),samplePosition:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],sampleLower:y._nextUint32(),sampleUpper:y._nextUint32()};n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(d);for(var m=new p(t,l,h,!0);m._offset<h;){var v=m._nextUint32(),S=m._scan(v),T=_(S),A=m._scan(v-S.byteLength);n.keyValue[T]=T.match(/^ktx/i)?_(A):A,m._offset%4&&m._skip(4-m._offset%4)}if(x<=0)return n;for(var w=new p(t,c,x,!0),B=w._nextUint16(),L=w._nextUint16(),I=w._nextUint32(),R=w._nextUint32(),E=w._nextUint32(),C=w._nextUint32(),P=[],O=0;O<a;O++)P.push({imageFlags:w._nextUint32(),rgbSliceByteOffset:w._nextUint32(),rgbSliceByteLength:w._nextUint32(),alphaSliceByteOffset:w._nextUint32(),alphaSliceByteLength:w._nextUint32()});var F=c+w._offset,G=F+I,K=G+R,X=K+E,k=new Uint8Array(t.buffer,t.byteOffset+F,I),N=new Uint8Array(t.buffer,t.byteOffset+G,R),V=new Uint8Array(t.buffer,t.byteOffset+K,E),M=new Uint8Array(t.buffer,t.byteOffset+X,C);return n.globalData={endpointCount:B,selectorCount:L,imageDescs:P,endpointsData:k,selectorsData:N,tablesData:V,extendedData:M},n},exports.write=function(t,e){void 0===e&&(e={}),e=h({},y,e);var n=new ArrayBuffer(0);if(t.globalData){var i=new ArrayBuffer(20+5*t.globalData.imageDescs.length*4),r=new DataView(i);r.setUint16(0,t.globalData.endpointCount,!0),r.setUint16(2,t.globalData.selectorCount,!0),r.setUint32(4,t.globalData.endpointsData.byteLength,!0),r.setUint32(8,t.globalData.selectorsData.byteLength,!0),r.setUint32(12,t.globalData.tablesData.byteLength,!0),r.setUint32(16,t.globalData.extendedData.byteLength,!0);for(var a=0;a<t.globalData.imageDescs.length;a++){var s=t.globalData.imageDescs[a];r.setUint32(20+5*a*4+0,s.imageFlags,!0),r.setUint32(20+5*a*4+4,s.rgbSliceByteOffset,!0),r.setUint32(20+5*a*4+8,s.rgbSliceByteLength,!0),r.setUint32(20+5*a*4+12,s.alphaSliceByteOffset,!0),r.setUint32(20+5*a*4+16,s.alphaSliceByteLength,!0)}n=g([i,t.globalData.endpointsData,t.globalData.selectorsData,t.globalData.tablesData,t.globalData.extendedData])}var o=[],U=t.keyValue;for(var p in e.keepWriter||(U=h({},t.keyValue,{KTXwriter:"KTX-Parse v0.2.1"})),U){var c=U[p],x=u(p),_="string"==typeof c?u(c):c,d=x.byteLength+1+_.byteLength+1,b=d%4?4-d%4:0;o.push(g([new Uint32Array([d]),x,l,_,l,new Uint8Array(b).fill(0)]))}var D=g(o),m=new ArrayBuffer(44),v=new DataView(m);if(1!==t.dataFormatDescriptor.length||t.dataFormatDescriptor[0].descriptorType!==exports.KTX2DescriptorType.BASICFORMAT)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");var S=t.dataFormatDescriptor[0];v.setUint32(0,44,!0),v.setUint16(4,S.vendorId,!0),v.setUint16(6,S.descriptorType,!0),v.setUint16(8,S.versionNumber,!0),v.setUint16(10,S.descriptorBlockSize,!0),v.setUint8(12,S.colorModel),v.setUint8(13,S.colorPrimaries),v.setUint8(14,S.transferFunction),v.setUint8(15,S.flags),v.setUint8(16,S.texelBlockDimension.x-1),v.setUint8(17,S.texelBlockDimension.y-1),v.setUint8(18,S.texelBlockDimension.z-1),v.setUint8(19,S.texelBlockDimension.w-1);for(var T=0;T<8;T++)v.setUint8(20+T,S.bytesPlane[T]);for(var A=0;A<S.samples.length;A++){var w=S.samples[A],B=28+16*A;v.setUint16(B+0,w.bitOffset,!0),v.setUint8(B+2,w.bitLength),v.setUint8(B+3,w.channelID),v.setUint8(B+4,w.samplePosition[0]),v.setUint8(B+5,w.samplePosition[1]),v.setUint8(B+6,w.samplePosition[2]),v.setUint8(B+7,w.samplePosition[3]),v.setUint32(B+8,w.sampleLower,!0),v.setUint32(B+12,w.sampleUpper,!0)}var L=f.length+68+3*t.levels.length*8,I=L+m.byteLength,R=I+D.byteLength;R%8&&(R+=8-R%8);for(var E=[],C=new DataView(new ArrayBuffer(3*t.levels.length*8)),P=R+n.byteLength,O=0;O<t.levels.length;O++){var F=t.levels[O];E.push(F.levelData),C.setBigUint64(24*O+0,BigInt(P),!0),C.setBigUint64(24*O+8,BigInt(F.levelData.byteLength),!0),C.setBigUint64(24*O+16,BigInt(F.uncompressedByteLength),!0),P+=F.levelData.byteLength}var G=new ArrayBuffer(68),K=new DataView(G);return K.setUint32(0,t.vkFormat,!0),K.setUint32(4,t.typeSize,!0),K.setUint32(8,t.pixelWidth,!0),K.setUint32(12,t.pixelHeight,!0),K.setUint32(16,t.pixelDepth,!0),K.setUint32(20,t.layerCount,!0),K.setUint32(24,t.faceCount,!0),K.setUint32(28,t.levels.length,!0),K.setUint32(32,t.supercompressionScheme,!0),K.setUint32(36,L,!0),K.setUint32(40,m.byteLength,!0),K.setUint32(44,I,!0),K.setUint32(48,D.byteLength,!0),K.setBigUint64(52,BigInt(R),!0),K.setBigUint64(60,BigInt(n.byteLength),!0),new Uint8Array(g([new Uint8Array(f).buffer,G,C.buffer,m,D,new ArrayBuffer(R-(I+D.byteLength)),n].concat(E)))};
//# sourceMappingURL=ktx-parse.js.map
